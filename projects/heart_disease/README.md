# 对心脏疾病的数据分析

## 数据集说明

### 源数据

本数据集选用的是经典的心脏疾病数据集，常常用于数据分析、机器学习等教学任务中。原文链接如下：
[https://archive.ics.uci.edu/dataset/45/heart+disease](https://archive.ics.uci.edu/dataset/45/heart+disease)

当然，这里我也将数据集上传到了根目录下的 `/data` 里面，方便大家直接下载使用。这里要说明的是，这个数据集并不是现在流行的 `.csv` 文件，而是各种分立的 `.data` 文件，在获取数据的时候其实可以直接通过链接来获取数据。

### 变量说明

下面这个表格说明了数据集中各个数据的含义

|变量名称|变量意义|
|:--:|:---|
|age|年龄|
|sex|性别（1=男，0 = 女）|
|cp|胸痛类型（1：典型心绞痛，2：非典型，3：非心绞痛，4：无症状|
|trestbps|静息血压|
|chol|胆固醇含量|
|fbs|空腹血糖（> 120 为1|
|restecg|静息心电图结果|
|thalach|达到的最大心率|
|exang|运动诱发的心绞痛（1=有，0=无）|
|oldpeak|运动相对于休息引起的ST段下降（心电图指标|
|slope|运动峰值ST段的斜率|
|ca|荧光透视染色的主要血管数量（0-3）|
|thal|地中海平血（3=正常，6=固定缺陷，7=可逆缺陷|
|target（或num）|疾病诊断（0=正常，1-4=不同程度的心脏病|

## 处理流程

### 0. 数据清洗 (Heart_Wrangling.R)

- **获取数据**：通过 `url` 获取数据
- **二分类处理**：对获取的数据进行初步清洗，因为数据集里的缺失值较少，我们直接将相应的行删除
- **因子化**：对 `target` 进行因子化，将有病（1-4）统一归为1，无病统一归为0
- 保存数据

### 1. 探索性数据分析 (Heart_EDA.R)

通过可视化手段，我们观察到几个关键特征：

- **年龄因素**：患病组的年龄分布中位数明显高于健康组，显示出心脏病风险随年龄增长的趋势。
- **性别差异**：在样本中，男性的患病比例显著高于女性。
- **生理指标**：患病组在“最大心率”上普遍低于健康苏，而在“ST段下降值”上显著高于健康组。

### 2. 推断性统计 (Heart_inferential.R)

我们通过严谨的数学检验确认了上述发现。

- **T检验**：对 `thalach` 进行双样本 T 检验，结果显示 $p < 0.05 $，证实两组间的心率差异具有统计学显著性
- **卡方检验**：对 `sex` 和 `target` 进行卡方检验，结果显著，证明性别与患病风险并非相互独立。
- **相关性矩阵**：热力图显示 `thal` 和 `oldpeak` 与 `target` 存在较强的相关性。

### 3. 预测建模与评估 (Heart_modeling.R)

采用 **逻辑回归** 模型进行预测：

- **模型拟合**：使用全变量构建逻辑回归模型，识别出 `cp`, `ca`, `thal` 是预测心脏病最显著的指标。
- **准确率**：模型在测试集上表现稳定，准确率达到了 $84.8\%$。
- **评估细节**：
  - **灵敏度**：约 $81.8\%$，能够有效捕获大部分患者。
  - **特异度**：约 $87.5\%$，对健康人群的排除能力较强。

## 如何运行

1. 确保安装了 R 语言环境及以下包：`tidyverse`, `ggplot2`, `corrplot`.
2. 依次运行脚本：
   1. `Heart_Wrangling.R`: 数据预处理。
   2. `Heart_EDA.R`: 生成探索性图表。
   3. `Heart_Modeling.R`:训练模型并输出混淆矩阵。
   4. 其余程序都是在数据预处理上完成的。直接运行即可。结果保存在 `data/heart_disease/result` 中
